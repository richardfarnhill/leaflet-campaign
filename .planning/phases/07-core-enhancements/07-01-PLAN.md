# Phase 7 Plan: Core Enhancements

**Goal:** Critical improvements to route cards, completion flow, security

**Dependencies:** Phase 6 (requires route creation UI complete)

---

## Tasks

### T1: Route Card Details - Street Names, Map Boundary

- [ ] Add `street_names` field to `target_areas` table (or use existing)
- [ ] Display street names on route cards
- [ ] Add "View Boundary" link/button that opens map showing route polygon
- [ ] Use Leaflet to draw route boundary from lat/lng points

**Verification:** Route cards show street names and working map link

---

### T2: Route Deletion UI

- [ ] Add delete button on route cards (admin only?)
- [ ] Confirmation modal before deletion
- [ ] Delete associated deliveries when route deleted
- [ ] Update summary stats after deletion

**Verification:** Can delete a route with all its data

---

### T3: RLS Policies Verification

- [ ] Review all table RLS policies in Supabase
- [ ] Verify: campaigns, target_areas, deliveries, enquiries, team_members, reservations
- [ ] Test that users can only see their campaign data
- [ ] Document RLS status in REQUIREMENTS.md

**Verification:** RLS policies tested and documented

---

### T4: Route Completion - Explicit Leaflet Count + Rolling Adjustment

- [ ] Change completion modal to require leaflet count input (not just checkbox)
- [ ] On completion: save explicit `leaflets_delivered` to `deliveries` table
- [ ] Track rolling campaign total: sum all deliveries per campaign
- [ ] Display "houses remaining" = target - delivered

**Verification:** Completion requires number, rolling total updates

---

### T5: Security - Move Credentials to config.js (URGENT)

- [ ] Remove hardcoded SUPABASE_URL from index.html
- [ ] Ensure config.js is loaded before app initializes
- [ ] Verify credentials not exposed in network requests
- [ ] Add .gitignore entry for config.js if not present

**Verification:** No credentials in index.html source

---

### T6: DB-driven Summary Bar Fix (CFG-03)

- [ ] Verify summary bar reads from: campaign.target_leaflets, deliveries, target_areas
- [ ] Remove any remaining hardcoded fallback values
- [ ] Test with multiple campaigns

**Verification:** Summary shows correct DB values

---

### T7: Phase Review

- [ ] Review all Phase 7 implementations
- [ ] Verify against requirements
- [ ] Document any gaps for Phase 8

---

## Success Criteria

1. Route cards show street names and map boundary link
2. Route deletion works with data cleanup
3. RLS policies verified and documented
4. Route completion requires explicit leaflet count
5. Credentials moved to config.js
6. Summary bar reads from DB
